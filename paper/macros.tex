% Theorems
\theoremstyle{plain} % Theorem/Definition/... in bold serif
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{example}[theorem]{Example}
\newtheorem{definition}[theorem]{Definition}
\crefname{proof}{Proof}{Proofs}

% Abbrev
\newcommand\ie{e.g.\xspace}
\newcommand\eg{e.g.\xspace}
\newcommand\etc{etc.\xspace}
\newcommand\wrt{wrt.\xspace}

% Comments and notes
\newcommand{\slpj}[1]{\emph{SLPJ: #1}}
\newenvironment{slpjenv}{\em SLPJ:}{}
\newcommand{\sg}[1]{\emph{SG: #1}}
\newcommand{\todo}[1]{\textcolor{red}{TODO: #1}}

% Auxiliary
\newcommand{\many}[1]{\overline{#1}}
\newcommand{\wild}{\ensuremath{\mathunderscore}}
\newcommand{\pfun}{\rightharpoonup}
\newcommand{\ruleform}[1]{\fbox{$#1$}}
\newcommand{\highlight}[1]{\setlength{\fboxsep}{2pt}\colorbox[gray]{0.8}{\ensuremath{#1}}}
\newcommand{\nelems}[1]{\lvert#1\rvert}
\newcommand{\fn}[2]{\ensuremath{λ#1.\ #2}}
%\newcommand{\fn}[2]{#1 ↦ #2}
\newcommand{\constfn}[1]{\fn{\mathunderscore}{#1}}
%\newcommand{\repeat}[2]{\foreach \n in {1,...,#1}{#2}} % https://tex.stackexchange.com/a/16190/52414
% https://tex.stackexchange.com/a/21647
\makeatletter
\newcommand{\superimpose}[3][\mathord]{#1{\mathpalette\superimpose@{{#2}{#3}}}}
\newcommand{\superimpose@}[2]{\superimpose@@{#1}#2}
\newcommand{\superimpose@@}[3]{%
  \ooalign{%
    \hfil$\m@th#1#2$\hfil\cr
    \hfil$\m@th#1#3$\hfil\cr
  }%
}
\newenvironment{letarray}{\begin{array}{@{}l@{\hspace{1ex}}l}}{\end{array}}
\newcommand{\noleftdelimiter}{\left.\kern-\nulldelimiterspace}
\newcommand{\later}{\mathop{\blacktriangleright}}
\newcommand{\purelater}{\mathop{\mathsf{next}}}
\newcommand{\aplater}{\mathbin{\circledast}}

% Syntax
%% LC
\newcommand{\Con}{\mathsf{Con}}
\newcommand{\Var}{\mathsf{Var}}
\newcommand{\Lab}{\mathsf{Lab}}
\newcommand{\Exp}{\mathsf{Exp}}
\newcommand{\Val}{\mathsf{Val}}
\newcommand{\Card}{\mathsf{Card}}
\newcommand{\px}{\mathsf{x}}
\newcommand{\py}{\mathsf{y}}
\newcommand{\pz}{\mathsf{z}}
\newcommand{\pv}{\mathsf{v}}
\newcommand{\pe}{\mathsf{e}}
\newcommand{\pc}{\mathsf{c}}
\newcommand{\pp}{\dot{\mathsf{e}}}
\newcommand{\Lam}[2]{\mathbf{\bar{\lambdaup}} #1. #2}
\newcommand{\LLam}[3]{\lambda_{#1} #2. #3}
\newcommand{\Lit}[1]{\llparenthesis #1 \rrparenthesis}
\newcommand{\Let}[3]{\mathbf{let}~{#1}={#2}~\mathbf{in}~{#3}}
\newcommand{\Letsmall}[3]{\mathbf{let}\,{#1}\!\!=\!\!{#2}\,\mathbf{in}\,{#3}}
\newcommand{\Ifz}[3]{\mathbf{ifz}(#1,#2,#3)}
\newcommand{\LLet}[4]{\mathbf{let}_{#1}~{#2}={#3}~\mathbf{in}~{#4}}
\newcommand{\Case}[2]{\mathbf{case}~{#1}~\mathbf{of}~{#2}}
\newcommand{\Sel}[1][]{\many{K~\many{x} \rightarrow e_{#1}}}
\newcommand{\SelArity}{\many{K~\many{x}^{α_K} \rightarrow e}}
\newcommand{\dom}{\mathop\mathsf{dom}}
\newcommand{\rng}{\mathop\mathsf{rng}}
\newcommand{\fv}{\mathop\mathsf{fv}}
\newcommand{\fa}{\mathop\mathsf{fa}}
\newcommand{\bv}{\mathop\mathsf{bv}}
\newcommand{\fresh}[2]{#1\mathbin{\#}#2}
\newcommand{\delvar}[1]{{\setminus_{#1}}}
\newcommand{\notfound}{\lightning}
\newcommand{\bool}{\mathtt{bool}}
\newcommand{\ttrue}{\mathtt{tt}}
\newcommand{\ffalse}{\mathtt{ff}}
%% Actions
\newcommand{\Actions}{\mathbb{A}}
\newcommand{\ValueA}{\mathsf{val}}
\newcommand{\BindA}{\mathsf{bind}}
\newcommand{\LookupA}{\mathsf{look}}
\newcommand{\UpdateA}{\mathsf{upd}}
\newcommand{\AppIA}{\mathsf{app}_1}
\newcommand{\AppEA}{\mathsf{app}_2}
\newcommand{\CaseIA}{\mathsf{case}_1}
\newcommand{\CaseEA}{\mathsf{case}_2}
%% Labels
\newcommand{\Labels}{\mathsf{Lab}}
\newcommand{\lbl}{\ensuremath{\ell}}
\newcommand{\lbln}[1]{\ensuremath{\ell_{#1}}}
\newcommand{\slbl}{\raisebox{0.08em}{$\scriptstyle{\ell}$\;}}
\newcommand{\slbln}[1]{\raisebox{0.1em}{$\;\scriptstyle{\ell_{#1}}\;$}}
\newcommand{\atlbl}[1]{at(#1)}
%% Traces
\newcommand{\return}{\rotatebox[origin=c]{180}{$\hspace{0.7pt}\Rsh$}}
\newcommand{\Traces}{\mathbb{T}}
\newcommand{\act}[1]{\xrightarrow{#1}}
\newcommand{\goodend}[1]{\langle #1 \rangle_{\checkmark}}
\newcommand{\stuckend}[1]{\langle #1 \rangle_{\lightning}}
\newcommand{\makestuck}[1]{\lightning(#1)}
\newcommand{\cons}{\mathbin{::}}
\newcommand{\trend}{\raisebox{-0.8pt}{\scalebox{0.3}{$\square$}}}
\newcommand{\betastep}{\mathbin{>\hspace{-0.40em}>\hspace{-0.48em}\text{β}\hspace{-0.40em}=}}
% https://latex.org/forum/viewtopic.php?p=62177&sid=26890ac77d076f3338384a47a2ffd4bc#p62177
\makeatletter
\newcommand{\concatop}[1]{%
  \mathbin{\mathop{#1}\limits^{\vbox to -1\ex@{\kern-\tw@\ex@
   \hbox{$\smallfrown$}\vss}}}}
\makeatother
\makeatletter
\newcommand{\compop}[1]{%
  \mathbin{\vec{\ooalign{$\circ$\cr\hidewidth$#1$\hidewidth}}}}
\makeatother
\newcommand{\concat}{\concatop{\cdot}}
\newcommand{\fcomp}{\compop{\cdot}}
\newcommand{\getval}[2]{#1 \Downarrow #2}
\newcommand{\subtrceq}{\superimpose[\mathrel]{\clipbox{0pt 0pt {0.3\width} 0pt}{${\subset}$}}{\hspace{0.6ex}\cdot}}
\newcommand{\rightsubtrceq}{\subtrceq_r}
\newcommand{\leftsubtrceq}{\subtrceq_l}
\newcommand{\stepm}[3]{\lceil #1 \act{#2} #3\trend \rceil}
\newcommand{\step}[2]{\stepm{\wild}{#1}{#2}}

%% Domains
\newcommand{\FunV}{\mathsf{Fun}}
\newcommand{\ConV}{\mathsf{Con}}
\newcommand{\Environments}{\mathbb{E}}
\newcommand{\Controls}{\mathbb{C}}
\newcommand{\ProgramPoints}{\mathbb{P}}
\newcommand{\Heaps}{\mathbb{H}}
\newcommand{\Continuations}{\mathbb{K}}
\newcommand{\Domain}[1]{{\mathbb{D}^{#1}}}
\newcommand{\Values}[1]{{\mathbb{V}^{#1}}}
\newcommand{\Base}[1]{\mathbf{#1}}
\newcommand{\ApproxMap}[2]{\mathsf{Map}(#1,#2)}
\newcommand{\FinStepMap}[2]{#1 \Rightarrow #2}
\newcommand{\PrefD}{\Domain{*}}
\newcommand{\MaxD}{\Domain{+\infty}}
\newcommand{\ScottD}{\Domain{\bot}}
\newcommand{\AbsD}{\Domain{\raisebox{0.1em}{\scalebox{0.4}{$\square$}}}}
\newcommand{\AbsCD}{\Domain{\raisebox{0.1em}{\scalebox{0.4}{c$\square$}}}}
\newcommand{\StateD}{\Domain{\States}}
\newcommand{\StateV}{\Values{\States}}
\newcommand{\SSD}{\Domain{Σ}}
\newcommand{\SSCD}{\Domain{cΣ}}
\newcommand{\LiveD}{\Domain{\exists l}}
\newcommand{\UsgD}{\Domain{\exists u}}
\newcommand{\LiveSD}{\Domain{sl}}
\newcommand{\LiveCD}{\Domain{cl}}
\newcommand{\LiveSCD}{\Domain{scl}}
\newcommand{\tr}{\ensuremath{\tilde{ρ}}}
\newcommand{\td}{\ensuremath{\tilde{d}}}

% Math
\newcommand{\poset}[1]{\wp(#1)}
\newcommand{\Nat}{\mathbb{N}}
\DeclareMathSymbol{\bbcolon}{\mathpunct}{bbold}{"3A}
\DeclareMathSymbol{\bbquestionmark}{\mathpunct}{bbold}{"3F}
\DeclareMathSymbol{\bblparen}{\mathpunct}{bbold}{"28}
\DeclareMathSymbol{\bbrparen}{\mathpunct}{bbold}{"29}
\DeclareMathSymbol{\bbpipe}{\mathpunct}{bbold}{"7C}
\newcommand{\ternary}[3]{\mathop{\bblparen} #1 \mathrel{\bbquestionmark} #2 \mathrel{\bbcolon} #3 \mathop{\bbrparen}}

% Order theory
\DeclareMathOperator*{\lub}{\sqcup}
\DeclareMathOperator*{\Lub}{\bigsqcup}
\DeclareMathOperator*{\glb}{\sqcap}
\DeclareMathOperator*{\Glb}{\bigsqcap}
\newcommand{\fix}{\mathop\mathsf{fix}}
\newcommand{\lfp}{\mathop\mathsf{lfp}}
\newcommand{\gfp}{\mathop\mathsf{gfp}}

% Semantics
\newcommand{\denot}[1]{\llbracket {#1} \rrbracket}
\newcommand{\semscott}[1]{\mathcal{S}^{\bot}\denot{#1}}
\newcommand{\sempref}[1]{\mathcal{S}^*\denot{#1}}
\newcommand{\seminf}[1]{\mathcal{S}^{+\infty}\denot{#1}}
\newcommand{\semst}[1]{\mathcal{S}^{\States}\denot{#1}}
\newcommand{\semss}[1]{\mathcal{S}^{Σ}\denot{#1}}
\newcommand{\semlive}[1]{\mathcal{S}^{∃l}\denot{#1}}
\newcommand{\semusg}[1]{\mathcal{S}^{∃u}\denot{#1}}
\newcommand{\semclive}[1]{\mathcal{S}^{cl}\denot{#1}}
\newcommand{\semslive}[1]{\mathcal{S}^{sl}\denot{#1}}
\newcommand{\semsclive}[1]{\mathcal{S}^{scl}\denot{#1}}
\newcommand{\semty}[1]{\mathcal{S}^{τ}\denot{#1}}

% Stateful
\newcommand{\States}{\mathbb{S}}
\newcommand{\STraces}{\mathbb{S}^{+\infty}}
\newcommand{\LKStates}{\mathbb{L}}
\newcommand{\sconcat}{\concatop{\hspace{0.04ex}\scalebox{0.5}{$\States$}}}
\newcommand{\sfcomp}{\compop{\scalebox{0.25}{\raisebox{0.7em}{$\States$}}}}
\newcommand{\pushF}{\cdot}
\newcommand{\StopF}{\mathbf{stop}}
\newcommand{\ApplyF}{\mathbf{ap}}
\newcommand{\SelF}{\mathbf{sel}}
\newcommand{\UpdateF}{\mathbf{upd}}

% Small-step
\newcommand{\Addresses}{\mathsf{Addr}}
\newcommand{\pa}{\mathsf{a}}
\newcommand{\smallstep}[1][\hspace{1.5ex}]{\xhookrightarrow{#1}}
\newcommand{\ssconcat}{\concatop{\hspace{0.04ex}\scalebox{0.5}{\Sigma}}}
\newcommand{\AppIT}{\textsc{App}_1}
\newcommand{\AppET}{\textsc{App}_2}
\newcommand{\ValueT}{\textsc{Val}}
\newcommand{\CaseIT}{\textsc{Case}_1}
\newcommand{\CaseET}{\textsc{Case}_2}
\newcommand{\LookupT}{\textsc{Look}}
\newcommand{\UpdateT}{\textsc{Upd}}
\newcommand{\BindT}{\textsc{Bind}}
\newcommand{\validtrace}[1]{#1\,\mathsf{ok\text{-}}τ}
\newcommand{\validtraceTriv}{\textsc{ok}_1}
\newcommand{\validtraceTrans}{\textsc{ok}_2}
\newcommand{\deep}[2]{#1\,\mathsf{deep}\,#2}
\newcommand{\deepn}[3]{#2\,\mathsf{deep}^{#1}\,#3}
\newcommand{\interior}[1]{#1\,\mathsf{inter}}
\newcommand{\interiorn}[2]{#2\,\mathsf{inter}^{#1}}
\newcommand{\balanced}[1]{#1\,\mathsf{bal}}
\newcommand{\maxtrace}[1]{#1\,\mathsf{max}}
\newcommand{\maxtracen}[2]{#2\,\mathsf{max}^{#1}}
\newcommand{\elabstate}[1]{#1\,\mathsf{elab}_σ}
\newcommand{\elabtrace}[1]{#1\,\mathsf{elab}_τ}
\newcommand{\elabtracen}[2]{#2\,\mathsf{elab}_τ^{#1}}
\newcommand{\contextendsflipped}{⊑_\Continuations}
\newcommand{\contextends}{⊒_\Continuations}
\newcommand{\contextendsstrict}{⊐_\Continuations}

% Liveness
\newcommand{\lStacks}{\Stacks^l}
\newcommand{\lLiveness}{\mathsf{Live}}
\newcommand{\lS}{\pS^l}
\newcommand{\lSBot}{\texttt{Seq}}
\newcommand{\lSAp}[1]{\texttt{\$[$#1$]}}
\newcommand{\lSTop}{\texttt{Deep}}
\newcommand{\lAbs}{\texttt{Abs}}
\newcommand{\lUsed}[1]{\texttt{Used[$#1$]}}
\newcommand{\SVar}{\mathsf{SVar}}
\newcommand{\SCall}{\mathsf{SCall}}

% Types
\newcommand{\TyCon}{\mathsf{TyCon}}
\newcommand{\Type}{\mathsf{Type}}
\newcommand{\ArrowTy}{\Rightarrow}

% Side braces in a matrix, https://tex.stackexchange.com/q/443407
\pgfkeys{tikz/mymatrixenv/.style={decoration={brace},every left delimiter/.style={xshift=8pt},every right delimiter/.style={xshift=-8pt}}}
\pgfkeys{tikz/mymatrix/.style={matrix of math nodes,nodes in empty cells,column sep=2pt,row sep=2pt,nodes={minimum width=10pt,minimum height=10pt,anchor=west,inner sep=0pt,outer sep=0pt}}}
\pgfkeys{tikz/mymatrixbrace/.style={decorate,thick}}
\newcommand*\mymatrixbraceright[4][m]{
    \draw[mymatrixbrace] (#1.west|-#1-#3-1.south west) -- node[left=2pt] {#4} (#1.west|-#1-#2-1.north west);
}
\newcommand*\mymatrixbraceleft[5]{
    \draw[mymatrixbrace] (#1.east|-#2-#3-1.east) -- node[right=2pt] (#1) {#5} (#1.east|-#2-#4-1.east);
}
\newcommand*\mymatrixbracetop[4][m]{
    \draw[mymatrixbrace] (#1.north-|#1-1-#2.north west) -- node[above=2pt] {#4} (#1.north-|#1-1-#3.north east);
}
\newcommand*\mymatrixbracebottom[4][m]{
    \draw[mymatrixbrace] (#1.south-|#1-1-#2.north east) -- node[below=2pt] {#4} (#1.south-|#1-1-#3.north west);
}
