% Theorems
\theoremstyle{plain} % Theorem/Definition/... in bold serif
\newtheoremrep{theorem}{Theorem}
\newtheoremrep{lemma}[theorem]{Lemma}
\newtheoremrep{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{example}[theorem]{Example}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{axiom}[theorem]{Axiom}
\newtheorem{abbreviation}[theorem]{Abbreviation}
\crefname{proof}{Proof}{Proofs}

% Abbrev
\newcommand\ie{i.e.\xspace}
\newcommand\eg{e.g.\xspace}
\newcommand\cf{cf.\xspace}
\newcommand\etc{etc.\xspace}
\newcommand\wrt{wrt.\xspace}

% Comments and notes
\makeatletter
\newcommand\ifnonanon[1]{%
\if@ACM@anonymous
\else
  #1%
\fi
}
\makeatother
\newcommand{\slpj}[1]{\ifnonanon{\emph{SLPJ: #1}}{}}
\newenvironment{slpjenv}{\em SLPJ:}{}
\newcommand{\sg}[1]{\ifnonanon{\emph{SG: #1}}{}}
\newcommand{\todo}[1]{\ifnonanon{\textcolor{red}{TODO: #1}}{}}

% Auxiliary
\newcommand{\many}[1]{\overline{#1}}
\newcommand{\wild}{\ensuremath{\mathunderscore}}
\newcommand{\pfun}{\rightharpoonup}
\newcommand{\ruleform}[1]{\fbox{$#1$}}
\newcommand{\highlight}[1]{\setlength{\fboxsep}{2pt}\colorbox[gray]{0.8}{\ensuremath{#1}}}
\newcommand{\nelems}[1]{\lvert#1\rvert}
\newcommand{\restrict}[1]{{|_{#1}}}
\newcommand{\fn}[2]{\ensuremath{λ#1.\ #2}}
%\newcommand{\fn}[2]{#1 ↦ #2}
\newcommand{\constfn}[1]{\fn{\mathunderscore}{#1}}
%\newcommand{\repeat}[2]{\foreach \n in {1,...,#1}{#2}} % https://tex.stackexchange.com/a/16190/52414
% https://tex.stackexchange.com/a/21647
\makeatletter
\newcommand{\superimpose}[3][\mathord]{#1{\mathpalette\superimpose@{{#2}{#3}}}}
\newcommand{\superimpose@}[2]{\superimpose@@{#1}#2}
\newcommand{\superimpose@@}[3]{%
  \ooalign{%
    \hfil$\m@th#1#2$\hfil\cr
    \hfil$\m@th#1#3$\hfil\cr
  }%
}
\makeatother
% Stacked operators like \lesseq, \lesssim, etc.
% https://tex.stackexchange.com/a/536604/52414
\makeatletter
\newcommand{\impsim}{\lesssim\!\gtrsim}
\newcommand{\lessequiv}{\mathrel{\raisebox{-1pt}{$\gl@over[0.25pt]{\vartriangleleft}{\sim}$}}}
\newcommand{\impequiv}{\mathrel{\raisebox{-1.25pt}{$\gl@over[0.25pt]{\superimpose{\raisebox{1pt}{\clipbox{0pt 3pt 0pt 3pt}{$\mid$}}}{\rotatebox[origin=c]{90}{$\lozenge$}}}{\sim}$}}}
\newcommand{\impapprox}{\lessapprox\!\gtrapprox}
\newcommand{\gl@over}[3][1pt]{%
  \vcenter{\m@th\offinterlineskip\ialign{%
    \hfil$##$\hfil\cr #2\cr \noalign{\vskip#1} #3\cr
  }}%
}
\makeatother
\newenvironment{letarray}{\begin{array}{@{}l@{\hspace{1ex}}l}}{\end{array}}
\newcommand{\later}{{\mathop{\vcenter{\hbox{$\scriptscriptstyle\blacktriangleright$}}}}}
\newcommand{\purelater}{\mathop{\mathsf{next}}}
\newcommand{\aplater}{\mathbin{\circledast}}
\newcommand{\formgoal}[2]{%
\vspace{0.5\baselineskip}
\noindent
\begin{minipage}{\linewidth}
\centering\fbox{\textbf{Goal #1}: \begin{varwidth}[t]{\linewidth - 9em}#2\end{varwidth}}
\end{minipage}%
\\[-0.5\baselineskip]
}

% Syntax
%% LC
\newcommand{\Con}{\mathsf{Con}}
\newcommand{\Var}{\mathsf{Var}}
\newcommand{\Exp}{\mathsf{Exp}}
\newcommand{\Ctx}{\mathsf{Ctx}}
\newcommand{\Val}{\mathsf{Val}}
\newcommand{\Usg}{\mathsf{Usg}}
\newcommand{\px}{\mathsf{x}}
\newcommand{\py}{\mathsf{y}}
\newcommand{\pz}{\mathsf{z}}
\newcommand{\pv}{\mathsf{v}}
\newcommand{\pe}{\mathsf{e}}
\newcommand{\pC}{\mathsf{C}}
\newcommand{\pE}{\mathsf{E}}
\newcommand{\Lam}[2]{\mathbf{\bar{\lambdaup}} #1. #2}
\newcommand{\Let}[3]{\mathbf{let}~{#1}\nobreak=\nobreak{#2}~\mathbf{in}~{#3}}
\newcommand{\Letn}[3]{\mathbf{let1}~{#1}\nobreak=\nobreak{#2}~\mathbf{in}~{#3}}
\newcommand{\Letsmall}[3]{\mathbf{let}\,{#1}\!\!=\!\!{#2}\,\mathbf{in}\,{#3}}
\newcommand{\Case}[2]{\mathbf{case}~{#1}~\mathbf{of}~{#2}}
\newcommand{\Sel}[1][]{\many{K~\many{\px} \rightarrow \pe_{#1}}}
\newcommand{\SelArity}{\many{K~\many{\px}^{α_K} \rightarrow \pe}}
\newcommand{\hole}{\square}
\newcommand{\dom}{\mathop{\mathsf{dom}}}
\newcommand{\rng}{\mathop\mathsf{rng}}
\newcommand{\fv}{\mathop\mathsf{fv}}
\newcommand{\disjoint}{\mathbin{\#}}
\newcommand{\delvar}[1]{{\setminus_{#1}}}
\newcommand{\bool}{\mathtt{bool}}
\newcommand{\ttrue}{\mathtt{tt}}
\newcommand{\ffalse}{\mathtt{ff}}
\newcommand{\tick}{\checkmark}
%% Traces
\newcommand{\Traces}{\mathbb{T}}
\newcommand{\ctrl}{\mathit{ctrl}}
\newcommand{\cont}{\mathit{cont}}
\newcommand{\inj}{\mathit{inj}}
\newcommand{\usg}{\mathit{usg}}
\newcommand{\pcirc}{%
  \mathchoice
    {\mathbin{\ooalign{\hidewidth$\circ$\hidewidth\cr$\rightharpoonup$}}}% \displaystyle
    {\mathbin{\ooalign{\hidewidth$\circ$\hidewidth\cr$\rightharpoonup$}}}% \textstyle
    {\mathbin{\ooalign{\hidewidth$\scriptstyle\circ$\hidewidth\cr$\scriptstyle\rightharpoonup$}}}% \scriptstyle
    {\mathbin{\ooalign{\hidewidth$\scriptscriptstyle\circ$\hidewidth\cr$\scriptscriptstyle\rightharpoonup$}}}% \scriptscriptstyle
}

%% Domains
\newcommand{\Environments}{\mathbb{E}}
\newcommand{\Heaps}{\mathbb{H}}
\newcommand{\Continuations}{\mathbb{K}}
\newcommand{\Domain}[1]{{\mathbb{D}^{#1}}}
\newcommand{\ScottD}{\Domain{\bot}}
\newcommand{\UsgD}{\Domain{u}}
\newcommand{\tr}{{\ensuremath{\tilde{ρ}}}}
\newcommand{\tm}{{\ensuremath{\tilde{μ}}}}
\newcommand{\ttau}{{\ensuremath{\tilde{τ}}}}
\newcommand{\tv}{{\ensuremath{\tilde{v}}}}
\newcommand{\td}{{\ensuremath{\tilde{d}}}}
\newcommand{\bigsteppn}[3]{\ensuremath{#2\!\Downarrow^{#1}\!#3}}
\newcommand{\bigstepp}[2]{\bigsteppn{}{#1}{#2}}
\newcommand{\bigstep}[4]{\ensuremath{{\langle#1,#2\rangle\!\!\Downarrow\!\!\langle#3,#4\rangle}}}
\newcommand{\bigstepn}[5]{\ensuremath{{\langle#2,#3\rangle\!\!\Downarrow^{#1}\!\!\langle#4,#5\rangle}}}
\newcommand{\forcesto}{\ensuremath{\rightsquigarrow}}
\newcommand{\forcessym}{\ensuremath{\leftrightsquigarrow}}
\newcommand{\correct}{\mathcal{C}}

% Math
\newcommand{\pow}[1]{\wp(#1)}
\newcommand{\Nat}{\mathbb{N}}
\DeclareMathSymbol{\bbcolon}{\mathpunct}{bbold}{"3A}
\DeclareMathSymbol{\bbquestionmark}{\mathpunct}{bbold}{"3F}
\DeclareMathSymbol{\bblparen}{\mathpunct}{bbold}{"28}
\DeclareMathSymbol{\bbrparen}{\mathpunct}{bbold}{"29}
\newcommand{\ternary}[3]{\mathop{\bblparen} #1 \mathrel{\bbquestionmark} #2 \mathrel{\bbcolon} #3 \mathop{\bbrparen}}

% Order theory
\DeclareMathOperator*{\lub}{\sqcup}
\DeclareMathOperator*{\Lub}{\bigsqcup}
\DeclareMathOperator*{\glb}{\sqcap}
\DeclareMathOperator*{\Glb}{\bigsqcap}
\newcommand{\fix}{\mathop\mathsf{fix}}
\newcommand{\lfp}{\mathop\mathsf{lfp}}
\newcommand{\gfp}{\mathop\mathsf{gfp}}

% Semantics
\newcommand{\denot}[1]{\llbracket {#1} \rrbracket}
\newcommand{\semscott}[1]{\mathcal{S}_{\bot}\denot{#1}}
\newcommand{\semsmall}[1]{\mathcal{S}_{\smallstep[\!]}\denot{#1}}
\newcommand{\semusg}[1]{\mathcal{S}_{u}\denot{#1}}

% Stateful
\newcommand{\States}{\mathbb{S}}
\newcommand{\STraces}{\mathbb{S}^{\infty}}
\newcommand{\pushF}{\cdot}
\newcommand{\StopF}{\mathbf{stop}}
\newcommand{\ApplyF}{\mathbf{ap}}
\newcommand{\SelF}{\mathbf{sel}}
\newcommand{\UpdateF}{\mathbf{upd}}

% Small-step
\newcommand{\Addresses}{\mathsf{Addr}}
\newcommand{\pa}{\mathsf{a}}
\newcommand{\smallstep}[1][\hspace{1.5ex}]{\xhookrightarrow{#1}}
\newcommand{\AppIT}{\textsc{App}_1}
\newcommand{\AppET}{\textsc{App}_2}
\newcommand{\ValueT}{\textsc{Val}}
\newcommand{\CaseIT}{\textsc{Case}_1}
\newcommand{\CaseET}{\textsc{Case}_2}
\newcommand{\LookupT}{\textsc{Look}}
\newcommand{\UpdateT}{\textsc{Upd}}
\newcommand{\BindT}{\textsc{Bind}}
\newcommand{\LetOT}{\textsc{Let}_0}
\newcommand{\LetIT}{\textsc{Let}_1}
\newcommand{\UnrollT}{\textsc{Unroll}}
\newcommand{\deep}[2]{#1\,\mathsf{deep}\,#2}
\newcommand{\interior}[1]{#1\,\mathsf{inter}}
\newcommand{\maxtrace}[1]{#1\,\mathsf{max}}
